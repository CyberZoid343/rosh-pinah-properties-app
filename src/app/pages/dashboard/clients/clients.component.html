<div class="card overflow-hidden">

  <div class="d-flex border-bottom p-3 align-items-center">
    <h4 class="mb-0 me-3">Clients</h4>
    <button class="btn btn-secondary ms-auto me-2" (click)="displayFilters()">
      <i class="fas fa-filter me-2"></i>
      <span *ngIf="showFilters">Hide Filters</span>
      <span *ngIf="!showFilters">Show Filters</span>
    </button>
    <button class="btn btn-primary" (click)="openClientFormDialog(0)"><i class="fas fa-plus-circle me-2"></i>Add New Client</button>
  </div>

  <div class="d-flex overflow-hidden">

    <app-filter-clients-form [showFilters]="showFilters" [total]="clients.length"></app-filter-clients-form>

    <div class="d-flex flex-column w-100 overflow-auto" style="height: calc(100vh - 100px)">
      <div class="py-5 d-flex align-items-center justify-content-center" *ngIf="gettingClients">
        <div class="spinner-border spinner-border-sm" role="status"></div>
        <span class="ms-2 text-nowrap">Loading Clients...</span>
      </div>
      <table class="custom-table text-nowrap" *ngIf="!gettingClients">
        <thead class="bg-light border-bottom">
          <th scope="col">Id</th>
          <th scope="col">Company</th>
          <th scope="col">Full Name</th>
          <th scope="col">Tags</th>
          <th scope="col">Email</th>
          <th scope="col" class="d-none">Cell</th>
          <th scope="col" class="d-none">Tel</th>
          <th scope="col">Last Contacted</th>
          <th scope="col">Follow Up</th>
          <th scope="col" class="d-none">Added</th>
          <th scope="col" class="d-none">Updated</th>
          <th scope="col">Status</th>
          <th scope="col" class="text-end">Actions</th>
        </thead>
        <tbody>
          <tr class="border-top border-bottom" *ngFor="let client of clients">
            <td>{{client.id}}</td>
            <td>{{client.companyName}}</td>
            <td>{{client.name}} {{client.surname}}</td>
            <td class="text-break">
                <span class="badge rounded-pill bg-primary me-1" *ngFor="let clientTag of client.clientTags">{{clientTag?.tag?.name}}</span>
            </td>
            <td>{{client.email}}</td>
            <td class="d-none">{{client.cellNumber}}</td>
            <td class="d-none">{{client.telNumber}}</td>
            <td>{{client.dateLastContacted | date: 'longDate'}}</td>
            <td>{{client.dateFollowUp | date: 'longDate'}}</td>
            <td class="d-none">{{client.dateAdded | date: 'longDate'}}</td>
            <td class="d-none">{{client.dateLastUpdated | date: 'longDate'}}</td>
            <td>
              <span *ngIf="client.isActive" class="badge rounded-pill bg-success mr-1">Active</span>
              <span *ngIf="!client.isActive" class="badge rounded-pill bg-danger mr-1">Inactive</span>
            </td>
            <td>
              <div class="btn-group" role="group" aria-label="Basic example">
                <button class="btn btn-outline-primary" (click)="openViewClientDetailsDialog(client.id)">View Details</button>
                <button  class="btn btn-outline-primary" [matMenuTriggerFor]="menu"><i class="fas fa-ellipsis-v"></i></button>
                <mat-menu #menu="matMenu" class="custom-dropdown">
                  <button class="dropdown-item"><i class="fa-solid fa-comment"></i>View Notes</button>
                  <button class="dropdown-item" (click)="openClientFormDialog(client.id)"><i class="fa-solid fa-pen"></i>Edit Details</button>
                  <button class="dropdown-item" (click)="openClientTagsDialog(client.id)"><i class="fa-solid fa-tags"></i>Edit Tags</button>
                  <button class="dropdown-item" (click)="openClientFollowUpDialog(client.id)"><i class="fa-solid fa-calendar"></i>Edit Follow Up</button>
                  <button class="dropdown-item"><i class="fa-solid fa-circle-check"></i>Mark Active</button>
                  <hr class="my-2">
                  <button class="dropdown-item text-danger" (click)="openDeleteClientDialog(client.id)"><i class="fa-solid fa-trash"></i>Delete</button>
                </mat-menu>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
