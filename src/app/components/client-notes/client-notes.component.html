<div class="modal-header" ngbAutofocus>
    <h5 class="my-auto">Client Notes</h5>
    <button class="btn p-0" ngbTooltip="Close" placement="bottom" (click)="closeModal('dismiss')"><i
            class="fa-solid fa-xmark" style="font-size: 18px;"></i></button>
</div>
<div class="modal-body text-center" *ngIf="loadingClientNotes">
    <app-loading-indicator [message]="loadingClientNotesMessage"></app-loading-indicator>
</div>
<div class="modal-body pt-0 bg-light" *ngIf="!loadingClientNotes">
    <div class="d-flex justify-content-center py-3 mt-3" *ngIf="clientNotes.length == 0 && !loadingClientNotes">
        <span>No data found</span>
    </div>
    <div class="note border bg-white p-3 mt-3 rounded" *ngFor="let clientNote of clientNotes">
        <div class="d-flex align-items-center mb-1">
            <div class="d-block">
                <b class="me-2">{{clientNote.user!.name}} {{clientNote.user!.surname}}</b>
                <small class="text-muted">{{clientNote.dateAdded | date: "mediumDate"}} {{clientNote.dateAdded | date: "shortTime"}}</small>
            </div>
            <div *ngIf="isUserNote(clientNote.userId)" class="ms-auto">
                <button class="btn btn-sm p-0 me-2" ngbTooltip="Edit" placement="bottom" (click)="editClientNote(clientNote.id!)" [disabled]="updatingClientNote || addingClientNote || loadingClientNotes"><i class="fa-solid fa-pen"></i></button>
                <button class="btn btn-sm p-0 text-danger" ngbTooltip="Delete" placement="bottom" (click)="deleteClientNote(clientNote.id!)" [disabled]="updatingClientNote || addingClientNote || loadingClientNotes"><i class="fa-solid fa-trash"></i></button>
            </div>
        </div>
        <p [ngClass]="{'d-none': editClientNoteId == clientNote.id}" class="mb-0">
            {{clientNote.description}}
            <small class="text-muted" *ngIf="clientNote.isEdited">(Edited {{clientNote.dateUpdated | date: "mediumDate"}} {{clientNote.dateUpdated | date: "shortTime"}})</small>
        </p>    
        <form [formGroup]="editForm" class="bg-light p-3 rounded border" *ngIf="editClientNoteId == clientNote.id">
            <textarea id="description" formControlName="description" class="form-control" [ngClass]="{ 'is-invalid': editSubmitted && editForm.controls.description.errors}"></textarea>
            <div class="invalid-feedback">
                <div *ngIf="editForm.controls.description.errors?.required">Required field</div>
            </div>
            <div class="d-flex mt-3">
                <button class="btn ms-auto me-2" (click)="cancelEditClientNote()">Cancel</button>
                <button class="btn btn-primary" (click)="updateClientNote(clientNote.id)" [disabled]="addingClientNote || updatingClientNote || loadingClientNotes">
                    <span *ngIf="!updatingClientNote">Updated Note</span>
                    <div class="d-flex align-items-center" *ngIf="updatingClientNote">
                        <span class="spinner-border spinner-border-sm"></span>
                        <span class="ms-2">Updating Note</span>
                    </div>
                </button>
            </div>
        </form>
    </div>
</div>
<form class="modal-footer justify-content-start bg-white" [formGroup]="form">
    <div class="d-block mb-2">
        <b class="me-2">{{currentUser}}</b>
        <small class="text-muted">{{currentDate | date: "short"}}</small>
    </div>
    <textarea class="form-control mb-0" rows="3" placeholder="Type your note details here..."
        id="description" formControlName="description" [ngClass]="{ 'is-invalid': submitted && form.controls.description.errors}"></textarea>
    <div class="invalid-feedback">
        <div *ngIf="form.controls.description.errors?.required">Required field</div>
    </div>
    <div class="d-flex ms-auto mt-3">
        <button type="button" class="btn btn-secondary me-2" (click)="closeModal('dismiss')">Cancel</button>
        <button type="button" class="btn btn-primary" (click)="addClientNote()" [disabled]="updatingClientNote || addingClientNote || loadingClientNotes">
            <span *ngIf="!addingClientNote">Add Note</span>
            <div class="d-flex align-items-center" *ngIf="addingClientNote">
                <span class="spinner-border spinner-border-sm"></span>
                <span class="ms-2">Adding Note</span>
            </div>
        </button>
    </div>
</form>