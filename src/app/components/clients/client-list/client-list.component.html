<div class="container-fluid p-3 text-nowrap">
    <div class="row">
        <div class="col-12">
            <div class="d-flex align-items-center">
                <h3 class="mb-0 me-2">Clients</h3>
                <button class="btn btn-outline-primary ms-auto" ngbTooltip="Show Filters" data-bs-toggle="offcanvas" data-bs-target="#offcanvasScrolling">
                    <i class="fa-solid fa-filter"></i>
                </button>
                <button class="btn btn-outline-primary ms-2" ngbTooltip="Clear Filters" (click)="clearFilters()">
                    <i class="fa-solid fa-filter-circle-xmark"></i>
                </button>
                <button class="btn btn-outline-primary ms-2" ngbTooltip="Refresh Page" (click)="refreshClientList()">
                    <i class="fa-solid fa-refresh"></i>
                </button>
                <button class="btn btn-outline-primary ms-2">
                    <i class="fa-solid fa-download me-2"></i>Export List
                </button>
                <button class="btn btn-primary ms-2" (click)="openClientFormDialog(0)">
                    <i class="fa-solid fa-plus me-2"></i>Add New Client
                </button>
            </div>
        </div>
        <div class="col-12">
            <hr>
        </div>
        <div class="col-12 mb-3">
            <div class="d-flex align-items-center">
                <div class="input-group flex-nowrap" style="max-width: 300px; min-width: 120px;">
                    <span class="input-group-text" id="addon-wrapping"><i class="fa-solid fa-search"></i></span>
                    <input type="text" class="form-control" placeholder="Search..."
                        (keyup.enter)="searchClients($event)">
                </div>
                <strong class="mx-2">{{clients.length}} results found</strong>
                <div class="dropdown ms-auto">
                    <button class="btn" data-bs-toggle="dropdown">
                        <span class="me-2">Last Contacted:</span>  
                        <b class="text-capitalize">{{lastContacted}}</b> 
                        <i class="fa-solid fa-caret-down ms-2"></i>
                    </button>
                    <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
                        <li><a class="dropdown-item" (click)="filterByLastContactedPeriod('all')">All</a></li>
                        <li><a class="dropdown-item" (click)="filterByLastContactedPeriod('today')">Today</a></li>
                        <li><a class="dropdown-item" (click)="filterByLastContactedPeriod('yesterday')">Yesterday</a>
                        </li>
                        <li><a class="dropdown-item" (click)="filterByLastContactedPeriod('ascending')">Ascending</a>
                        </li>
                        <li><a class="dropdown-item" (click)="filterByLastContactedPeriod('descending')">Descending</a>
                        </li>
                    </ul>
                </div>
                <div class="dropdown ms-2">
                    <button class="btn" data-bs-toggle="dropdown">
                        <span class="me-2">Follow Up:</span>
                        <b class="text-capitalize">{{followUp}}</b>
                        <i class="fa-solid fa-caret-down ms-2"></i>
                    </button>
                    <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
                        <li><a class="dropdown-item" (click)="filterByFollowUpPeriod('all')">All</a></li>
                        <li><a class="dropdown-item" (click)="filterByFollowUpPeriod('today')">Today</a></li>
                        <li><a class="dropdown-item" (click)="filterByFollowUpPeriod('tomorrow')">Tomorrow</a></li>
                        <li><a class="dropdown-item" (click)="filterByFollowUpPeriod('overdue')">Overdue</a></li>
                        <li><a class="dropdown-item" (click)="filterByFollowUpPeriod('ascending')">Ascending</a></li>
                        <li><a class="dropdown-item" (click)="filterByFollowUpPeriod('descending')">Descending</a></li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="col-12">
            <ul class="nav nav-tabs" id="myTab" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link" data-bs-toggle="tab" (click)="filterByStatus('all')"
                        [class]="{'active': status == 'all'}">All</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" data-bs-toggle="tab" (click)="filterByStatus('active')"
                        [class]="{'active': status == 'active'}">Active</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" data-bs-toggle="tab" (click)="filterByStatus('inactive')"
                        [class]="{'active': status == 'inactive'}">Inactive</button>
                </li>
            </ul>
            <table class="table table-striped table-hover">
                <thead class="table-dark">
                    <tr>
                        <th scope="col">Client</th>
                        <th scope="col">Company</th>
                        <th scope="col">Tags</th>
                        <th scope="col">Last Contacted</th>
                        <th scope="col">Follow Up</th>
                        <th scope="col" class="d-none">Updated</th>
                        <th scope="col">Status</th>
                        <th scope="col" class="text-end">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngIf="gettingClientSet">
                        <td colspan="12" class="text-center">
                            <app-loading-indicator [message]="loadingClientsMessage"></app-loading-indicator>
                        </td>
                    </tr>
                    <tr *ngIf="clients.length == 0 && !gettingClientSet">
                        <td colspan="12" class="text-center">
                            <span>No data found</span>
                        </td>
                    </tr>
                    <tr *ngFor="let client of clients" class="align-middle">
                        <td>
                            <span class="d-block">{{client.name}} {{client.surname}}</span>
                            <small class="text-muted">{{client.email}}</small>
                        </td>
                        <td>{{client.companyName}}</td>
                        <td class="text-wrap" style="max-width: 300px;">
                            <span class="badge rounded-pill bg-transparent-primary" style="margin: 1px;"
                                *ngFor="let tag of client.tagArray">{{tag}}</span>
                        </td>
                        <td style="max-width: 120px" class="text-truncate">
                            <span class="d-block">{{client.dateLastContacted | date: "mediumDate"}}</span>
                            <small class="text-muted" *ngIf="client.lastContactedDays! < -1">{{client.lastContactedDays!
                                * -1}} days ago</small>
                            <small class="text-muted" *ngIf="client.lastContactedDays! == -1">Yesterday</small>
                            <small class="text-muted" *ngIf="client.lastContactedDays! == 0">Today</small>
                        </td>
                        <td style="max-width: 120px" class="text-truncate">
                            <span class="d-block">
                                <i class="fa-solid fa-circle-exclamation text-danger me-1"
                                    *ngIf="client.followUpDays! < 0 && client.isActive"></i>
                                <i class="fa-solid fa-triangle-exclamation text-warning me-1"
                                    *ngIf="client.followUpDays! == 1 && client.isActive"></i>
                                <i class="fa-solid fa-comment-dots text-success me-1"
                                    *ngIf="client.followUpDays! == 0 && client.isActive"></i>
                                {{client.dateFollowUp | date: "mediumDate"}}
                            </span>
                            <small class="text-muted" *ngIf="client.followUpDays! < -1">{{client.followUpDays! * -1}}
                                days overdue </small>
                            <small class="text-muted" *ngIf="client.followUpDays! == -1">Due yesterday</small>
                            <small class="text-muted" *ngIf="client.followUpDays! == 0">Due today</small>
                            <small class="text-muted" *ngIf="client.followUpDays! == 1">Due tomorrow</small>
                            <small class="text-muted" *ngIf="client.followUpDays! > 1">Due in {{client.followUpDays!}}
                                days</small>
                        </td>
                        <td style="max-width: 120px" class="text-truncate d-none">
                            <span class="d-block">{{client.dateUpdated | date: "mediumDate"}}</span>
                            <small class="text-muted" *ngIf="client.updatedDays! == 0">Today by</small>
                            <small class="text-muted" *ngIf="client.updatedDays! == -1">Yesterday by</small>
                            <small class="text-muted" *ngIf="client.updatedDays! < -1">{{client.updatedDays! * -1}} days
                                ago by</small>
                            <small class="text-muted d-block">{{client.lastEditor!.name}}
                                {{client.lastEditor!.surname}}</small>
                        </td>
                        <td style="max-width: 50px;">
                            <span *ngIf="client.isActive"
                                class="badge rounded-pill bg-transparent-success">Active</span>
                            <span *ngIf="!client.isActive"
                                class="badge rounded-pill bg-transparent-danger">Inactive</span>
                        </td>
                        <td style="width: 0px;">
                            <div class="d-flex justify-content-end">
                                <div class="dropdown">
                                    <button class="btn" data-bs-toggle="dropdown">
                                        <i class="fa-solid fa-ellipsis"></i>
                                    </button>
                                    <ul class="dropdown-menu">
                                        <li>
                                            <button class="dropdown-item">
                                                <i class="fa-solid fa-folder-open me-2"></i>
                                                Details
                                            </button>
                                        </li>
                                        <li>
                                            <button class="dropdown-item" (click)="openClientFormDialog(client.id)">
                                                <i class="fa-solid fa-pen me-2"></i>
                                                Edit
                                            </button>
                                        </li>
                                        <li>
                                            <button class="dropdown-item" (click)="updateClientStatus(client)"
                                                *ngIf="!client.isActive">
                                                <i class="fa-solid fa-circle-check me-2"></i>
                                                Mark Active
                                            </button>
                                        </li>
                                        <hr class="dropdown-divider">
                                        <li>
                                            <button class="dropdown-item text-danger"
                                                (click)="updateClientStatus(client)" *ngIf="client.isActive">
                                                <i class="fa-solid fa-circle-xmark me-2"></i>
                                                Mark Inactive
                                            </button>
                                        </li>
                                        <li>
                                            <button class="dropdown-item text-danger" (click)="deleteClient(client.id)">
                                                <i class="fa-solid fa-trash me-2"></i>
                                                Delete
                                            </button>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<div class="offcanvas offcanvas-end " data-bs-scroll="true" data-bs-backdrop="false" id="offcanvasScrolling">
    <div class="offcanvas-header border-bottom">
        <h5 class="offcanvas-title">Filters</h5>
        <button class="btn-close text-reset" data-bs-dismiss="offcanvas"></button>
    </div>
    <div class="offcanvas-body">
        Content for the offcanvas goes here.
    </div>
</div>